# orchan - объединение done-каналов в Go

Пакет `orchan` предоставляет функцию `Or`, которая объединяет несколько **done-каналов** (каналов завершения) в один. 
Результат закрывается **сразу, как только закроется любой из исходных каналов**.

Это полезно, когда вы ждёте завершения **любого** из нескольких событий: например, таймаута, отмены через `context`, или завершения горутины.

## Пример использования

```go
package main

import (
	"fmt"
	"time"
	"orchan"
)

func main() {
	sig := func(after time.Duration) <-chan interface{} {
		c := make(chan interface{})
		go func() {
			defer close(c)
			time.Sleep(after)
		}()
		return c
	}

	start := time.Now()
	<-orchan.Or(
		sig(2*time.Hour),
		sig(5*time.Minute),
		sig(1*time.Second), // завершится из-за этого канала
		sig(1*time.Hour),
	)
	fmt.Printf("Готово через %v\n", time.Since(start))
}
```

Примерный вывод:
```
Готово через 1.001s
```

## Как это работает?

Функция `Or` запускает по одной горутине на каждый входной канал.  
Как только любой из каналов **закрывается или посылает значение**, `Or` **немедленно закрывает** свой выходной канал.

Чтобы избежать паники при попытке закрыть канал дважды (например, если два канала завершаются почти одновременно), используется `sync.Once`.

## Почему именно такая реализация?

Существует несколько способов реализовать `Or`:

### **Рекурсивное объединение**
Можно рекурсивно комбинировать каналы попарно (`Or(ch1, Or(ch2, Or(ch3, ...)))`).  
**Минусы**:
- Создаётся **много промежуточных каналов и горутин**
- При большом числе каналов **глубокая рекурсия и высокие накладные расходы**

### **reflect.Select**
Можно использовать `reflect.Select`, чтобы ждать N каналов в одной горутине.  
**Минусы**:
- Зависимость от пакета `reflect`
- Замедляет выполнение
- Усложняет чтение кода

### **Текущий подход: горутины + sync.Once**
- **Простота**: легко понять и поддерживать
- **Эффективность**: одна горутина на канал, без рекурсии
- **Безопасность**: `sync.Once` гарантирует, что выходной канал будет закрыт **ровно один раз**, даже если несколько входных каналов завершились одновременно или один и тот же канал передан несколько раз
- **Без reflect**: не используем рефлексию, что делает код быстрее и понятнее

## Тестирование

```bash
go test -v ./orchan
```

Все тесты независимы и могут запускаться параллельно.
