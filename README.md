# orchan - объединение done-каналов в Go

Пакет `orchan` предоставляет функцию `Or`, которая объединяет несколько **done-каналов** (каналов завершения) в один. 
Результат закрывается **сразу, как только закроется любой из исходных каналов**.

## Пример использования

```go
package main

import (
	"fmt"
	"time"

	"github.com/danilovaalina/orchan/orchan"
)

func main() {
	sig := func(after time.Duration) <-chan interface{} {
		c := make(chan interface{})
		go func() {
			defer close(c)
			time.Sleep(after)
		}()
		return c
	}

	start := time.Now()
	<-orchan.Or(
		sig(2*time.Hour),
		sig(5*time.Minute),
		sig(1*time.Second), // завершится из-за этого канала
		sig(1*time.Hour),
	)
	fmt.Printf("done after %v\n", time.Since(start))
}
```

Примерный вывод:
```
done after 1.0010695s
```
---

## Как это работает?

Функция `Or` использует **рекурсивное объединение каналов попарно** и передаёт внутрь **канал отмены (`orDone`)**.

Как только любой канал сигнализирует о завершении:
- Выходной канал закрывается,
- Все вложенные вызовы `Or` **автоматически отменяются** через `orDone`,
- **Нет утечек горутин**, даже если часть каналов никогда не закрывается.
---

## Почему именно такая реализация?

- Использование пакета **`reflect`**: замедляет код и усложняет чтение, в этом нет необходимости.
- **Горутина на каждый канал**: без механизма отмены **приводит к утечкам**, если каналы не закрываются.
- Наш подход: 
  - **Безопасность**: нет паник при одновременном завершении нескольких каналов.
  -  **Нет утечек**: механизм отмены гарантирует завершение всех вспомогательных горутин.
---

## Тестирование

Проект включает полный набор тестов, включая проверку на **утечки горутин** с помощью [`goleak`](https://github.com/uber-go/goleak):

Запуск тестов:
```bash
go test -v ./orchan
```
Все тесты независимы и могут запускаться параллельно.

---

> **Done-каналы в Go** - это идиома, при которой закрытие канала означает "сигнал завершения".  
> Функция `orchan.Or` следует этой идиоме: она **закрывает** выходной канал, а не посылает в него значение.
```

---